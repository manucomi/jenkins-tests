import { Meta, Story, Canvas } from '@storybook/addon-docs';
import { useState } from 'react';
import cookieCutter from 'cookie-cutter';
import InterstitialModal from 'Components/InterstitialModal/InterstitialModal';

# Playground

Play with the controls and see how the component changes.

<Meta title="Components/InterstitialModal" component={InterstitialModal} />

export const loadScript = () => {
    const newtag = document.createElement('script');
    newtag.src = 'https://securepubads.g.doubleclick.net/tag/js/gpt.js';
    newtag.async = true;
    document.head.appendChild(newtag);
    window.googletag = newtag;
};

export const loadConsentData = () => {
    window.googlefc = {
        callbackQueue: {
            push: (item) => {
                item.CONSENT_DATA_READY();
            },
        },
    };
    const mockTCData = {
        gdprApplies: false,
        eventStatus: 'tcloaded',
        purpose: {
            consents: [true],
        },
    };
    // eslint-disable-next-line no-underscore-dangle
    window.__tcfapi = (eventType, version, callback) => {
        callback(mockTCData, true);
    };
};

<!-- eslint-disable react/prop-types -->

export function RenderingHelper({ children }) {
    const [key, setKey] = useState(1);
    const reMount = () => {
        cookieCutter.set('marketing_interruption', '', {
            expires: new Date(0),
        });
        setKey((prevKey) => prevKey + 1);
    };
    return (
        <div key={key}>
            {children}
            <div>
                <button type="button" onClick={reMount}>
                    Remount InterstitialModal
                </button>
            </div>
        </div>
    );
}

export function Template(args) {
    const { desktopAdProps } = args;
    loadScript();
    loadConsentData();
    return (
        <RenderingHelper>
            <InterstitialModal desktopAdProps={desktopAdProps} />
        </RenderingHelper>
    );
}

<Canvas>
    <Story
        name="Playground"
        args={{
            desktopAdProps: {
                path: '/34363400/TEST_Single-PartnerCenter_230x230',
                size: [[230, 230]],
                targets: { position: '11' },
            },
        }}
    >
        {Template.bind({})}
    </Story>
</Canvas>
